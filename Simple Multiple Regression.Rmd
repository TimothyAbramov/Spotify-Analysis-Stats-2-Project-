---
title: "Simple Multiple Regression"
output: html_document
date: "`r Sys.Date()`"
---
```{r}
#!!!Steps to show(by slides)
#1. Corellation matrix for both Popularity and Danceability
#2. Original models(with "1" at the end) outputs
#3. VIF check + performance of "2" models (with insignif vars removed)
#4. Adding Genre step, anova results for both
#5. Final models + performance/fit of the model (RSE, R^2)
#!!!
```

```{r warning=FALSE, message=FALSE}
#initial setup
library(tidyverse)
library(GGally)
library(car)

#setwd("/Users/home/Downloads/5. Github Public Repos/Spotify Analysis (Stats 2 Project)")
spotify <- read_csv("data/Spotify-2000.csv")
```

```{r}
#select the needed data & rename some columns
spotify_smlr <- spotify %>%
  select(Popularity, Acousticness, Speechiness, `Length (Duration)`,
         Valence, Liveness, `Loudness (dB)`, Energy,
         `Beats Per Minute (BPM)`, `Top Genre`, Danceability) %>%
  rename(Loudness = `Loudness (dB)`,
         BPM = `Beats Per Minute (BPM)`,
         Length = `Length (Duration)`,
         Genre = `Top Genre`)

spotify_smlr <- spotify_smlr %>%
  mutate(Genre = case_when(
    grepl("rock", Genre, ignore.case = TRUE) ~ "Rock",
    grepl("pop", Genre, ignore.case = TRUE) ~ "Pop",
    grepl("soul", Genre, ignore.case = TRUE) ~ "Soul",
    grepl("blues", Genre, ignore.case = TRUE) ~ "Blues",
    grepl("hip hop", Genre, ignore.case = TRUE) ~ "Hip Hop",
    TRUE ~ "Other"
  ))
spotify_smlr <- spotify_smlr %>%
  mutate(danceCat = case_when(
    Danceability >=50 ~ 1,
    Danceability <50 ~ 0
  ))
```

## Chi squared: Danceability & Genre

```{r, warning=FALSE}
table_genre_dance <- table(spotify_smlr$Genre, spotify_smlr$danceCat)

# Print the contingency table to see the counts
print(table_genre_dance)

# Run the chi-squared test
chi_squared_result <- chisq.test(table_genre_dance)

# Print the result of the chi-squared test
print(chi_squared_result)
```


```{r}

## Popularity

### collinearity check

```{r fig.width=8, fig.height=8}
#checking for collinearity of quantitative variables (drop valence and energy)
ggcorr(data = spotify_smlr %>% select(-Genre, -Popularity),
       label = TRUE, label_round = 2, label_size = 6,
       size = 6, hjust = 0.75,
       layout.exp = 1)

#lm without genre
popular_lm1 <- lm(Popularity ~ Acousticness + Speechiness + Length + Valence + Liveness + Loudness + BPM + Danceability + Energy,
                  data = spotify_smlr)
summary(popular_lm1)
```

### multi-collinearity

```{r}
#checking for multi-collinearity(not present):
vif(popular_lm1) #vif should be <5 for all vars
```

### dropped insignificant

```{r}
#Popularity continued
#dropping insignifican ones(energy)
popular_lm2 <- lm(Popularity ~ Speechiness + Liveness + Loudness + Danceability,
                  data = spotify_smlr)
summary(popular_lm2)
```

### genre

```{r}
#Popularity continued
#adding Genre categorical variable
popular_lm3 <- lm(Popularity ~ Speechiness + Liveness + Loudness + Danceability + Genre,
                  data = spotify_smlr)

#check if Genre is significant (incremental F-test)
popular_full_lm <- lm(Popularity ~ Speechiness + Liveness + Loudness + Danceability + Genre,
                  data = spotify_smlr)

popular_null_lm <- lm(Popularity ~ Speechiness + Liveness + Loudness + Danceability,
                  data = spotify_smlr)

anova(popular_null_lm, popular_full_lm)
```

Okay, genre is significant, will keep it in the model. Final model vars for Popularity: Speechiness + Liveness + Loudness + Danceability + Genre

```{r}
#final model
summary(popular_lm3)
```

!!!Also, I haven't done any interactions for this model, might wanna try do one with interactions and see if it improves anything.

## Danceability

### collinearity check

```{r fig.width=8, fig.height=8}
#checking for collinearity of quantitative variables (drop energy + acousticness)
ggcorr(data = spotify_smlr %>% select(-Genre, -Danceability),
       label = TRUE, label_round = 2, label_size = 6,
       size = 6, hjust = 0.75,
       layout.exp = 1)

#lm without genre
dance_lm1 <- lm(Danceability ~ Popularity + Speechiness + Length + Valence + Liveness + Loudness + BPM + Energy,
                  data = spotify_smlr)
summary(dance_lm1)
```

### vif

```{r}
#checking for multiple-collinearity
vif(dance_lm1)
```

### drop insignif

```{r}
#dropped length and loudness and energy
dance_lm2 <- lm(Danceability ~ Popularity + Speechiness + Valence + Liveness + BPM,
                  data = spotify_smlr)
summary(dance_lm2)
```

### genre

```{r}
#Danceability continued
#adding Genre categorical variable
dance_lm3 <- lm(Danceability ~ Popularity + Speechiness + Valence + Liveness + BPM + Genre,
                  data = spotify_smlr)

#check if Genre is significant (incremental F-test)
dance_full_lm <- lm(Danceability ~ Popularity + Speechiness + Valence + Liveness + BPM + Genre,
                  data = spotify_smlr)


dance_null_lm <- lm(Danceability ~ Popularity + Speechiness + Valence + Liveness + BPM,
                  data = spotify_smlr)


anova(dance_null_lm, dance_full_lm)
```

Genre is significant for this model as well. Final list of vars used in the final model: Popularity + Speechiness + Valence + Liveness + BPM + Genre

```{r}
#final Danceability model
summary(dance_lm3)
```
